<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:osgi="http://www.eclipse.org/gemini/blueprint/schema/blueprint"
	xmlns:osgix="http://www.eclipse.org/gemini/blueprint/schema/blueprint-compendium"
	xmlns:websocket="http://www.springframework.org/schema/websocket"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
		http://www.springframework.org/schema/websocket
		http://www.springframework.org/schema/websocket/spring-websocket.xsd
		http://www.eclipse.org/gemini/blueprint/schema/blueprint
		http://www.eclipse.org/gemini/blueprint/schema/blueprint/gemini-blueprint.xsd
		http://www.eclipse.org/gemini/blueprint/schema/blueprint-compendium
		http://www.eclipse.org/gemini/blueprint/schema/blueprint-compendium/gemini-blueprint-compendium.xsd">

	<websocket:handlers>
		<websocket:mapping path="/ocpp/v16/cs/json/**" handler="ocppWebSocketHandler_v16"/>
		<websocket:handshake-interceptors>
			<bean class="net.solarnetwork.node.ocpp.v16.cs.json.web.OcppWebSocketHandshakeInterceptor"/>
		</websocket:handshake-interceptors>
	</websocket:handlers>

	<bean id="ocppWebSocketHandler_v16" class="net.solarnetwork.node.ocpp.v16.cs.json.web.OcppWebSocketHandler">
		<property name="callMessageProcessor" ref="callMessageActionRouter"/>
	</bean>
	
	<osgi:list id="triggers" interface="net.solarnetwork.node.ocpp.service.ActionMessageProcessor" availability="optional">
		<osgi:reference-listener  bind-method="addActionMessageProcessor" unbind-method="removeActionMessageProcessor" ref="callMessageActionRouter"/>
	</osgi:list>
	
	<bean id="callMessageActionRouter" class="net.solarnetwork.node.ocpp.json.CallMessageActionRouter">
		<constructor-arg value="#{T(ocpp.v16.ActionErrorCode).InternalError}"/>
		<constructor-arg value="#{T(ocpp.v16.ActionErrorCode).NotImplemented}"/>
	</bean>
	
</beans>
